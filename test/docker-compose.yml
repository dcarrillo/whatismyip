services:
  whatismyip:
    build:
      context: ../
      target: dev
    ports:
      - "8000:8000"
      - "8001:8001"
      - "8001:8001/udp"
      - "53531:53/udp"
    command:
      - "-geoip2-city"
      - "/GeoIP2-City-Test.mmdb"
      - "-geoip2-asn"
      - "/GeoLite2-ASN-Test.mmdb"
      - "-bind"
      - ":8000"
      - "-tls-bind"
      - ":8001"
      - "-tls-crt"
      - "/server.pem"
      - "-tls-key"
      - "/server.key"
      - "-trusted-header"
      - "X-Real-IP"
      - "-enable-secure-headers"
      - "-enable-http3"
      - "-resolver"
      - "/resolver.yml"
    volumes:
      - ./GeoIP2-City-Test.mmdb:/GeoIP2-City-Test.mmdb
      - ./GeoLite2-ASN-Test.mmdb:/GeoLite2-ASN-Test.mmdb
      - ./server.pem:/server.pem
      - ./server.key:/server.key
      - ./resolver.yml:/resolver.yml
